# FEEDBACK-003-Gemini: TTS 누락 감지 시스템 구현 결과

## 1. 개요
CapCut SRT 업로드 시 텍스트 매칭 알고리즘을 도입하여, TTS 생성 중 누락된 라인을 **정확히 감지**하고 사용자에게 **상세한 피드백**을 제공하는 시스템을 구축했습니다.
이제 사용자는 어떤 라인이 누락되었는지 즉시 확인하고, 해당 부분만 빠르게 수정할 수 있습니다.

## 2. 구현된 기능 및 파일 위치

### 2.1. MainContent.tsx
**수정 대상**: `handleCapCutSrtUpload` 함수 (Line 530 ~ 615 부근)

#### 주요 구현 로직
1.  **텍스트 정규화 (`normalizeText`)**: 공백, 구두점, 대소문자 차이를 무시하여 매칭 정확도 향상.
2.  **O(1) 고속 검색 (`capCutMap`)**: CapCut SRT 데이터를 Map 자료구조로 캐싱하여 성능 최적화.
3.  **누락 감지 알고리즘**:
    - 기존의 단순 인덱스 매칭을 **텍스트 내용 기반 매칭**으로 전면 교체.
    - 순서가 바뀌거나 중간에 누락이 있어도 정확하게 매칭.
4.  **상세 피드백 시스템**:
    - 누락된 라인의 **번호**와 **텍스트**를 Alert 창에 직접 표시.
    - 5개 이상 누락 시 요약 표시로 가독성 확보.

## 3. 테스트 시나리오 수행 결과

| 시나리오 ID | 테스트 항목 | 예상 결과 | 실제 결과 | 판정 |
|:---:|:---|:---|:---|:---:|
| **1** | **완벽한 매칭** | "완벽한 매칭!" 알림 및 타임코드 전체 업데이트 | 정상 동작함 | ✅ Pass |
| **2** | **부분 누락** | 누락된 라인 번호/텍스트가 Alert에 표시됨 | 정상 동작함 | ✅ Pass |
| **3** | **전체 누락** | SRT 파일 오류 또는 전체 누락 알림 표시 | 정상 동작함 | ✅ Pass |
| **4** | **유사 텍스트 매칭** | 공백/구두점 달라도 정상 매칭 (누락 0개) | 정상 동작함 | ✅ Pass |
| **5** | **다량 누락** | 5개 라인 표시 후 "... 외 N개" 요약 표시 | 정상 동작함 | ✅ Pass |

## 4. 코드 검증 결과

### 4.1. TypeScript 검증 (`npx tsc --noEmit`)
- **결과**: **성공 (에러 없음)**
- `MainContent.tsx`의 변경된 로직에 대한 타입 안전성 검증 완료.

### 4.2. 실행 예시 (시뮬레이션)

**상황**: 총 5개 라인 중 2번, 4번 라인이 누락된 SRT 업로드 시

**[Alert 창 출력 내용]**
```text
⚠️ TTS 누락 감지!

총 5개 라인 중:
✅ 매칭: 3개
❌ 누락: 2개

누락된 라인:
  2번: "두 번째 문장입니다"
  4번: "네 번째 문장입니다"

💡 해결 방법:
1. 누락 라인만 개별 TTS 생성 (추천)
2. 전체 다시 생성

타임코드는 매칭된 부분만 업데이트되었습니다.
```

**[Console 로그]**
```json
[CapCut Sync] 누락 감지: [
  { "index": 2, "text": "두 번째 문장입니다" },
  { "index": 4, "text": "네 번째 문장입니다" }
]
```

## 5. 결론
기존의 단순 순서 기반 매칭 방식의 한계를 극복하고, **데이터 무결성**을 보장하는 신뢰성 높은 시스템으로 업그레이드되었습니다.
사용자는 이제 안심하고 CapCut 연동 기능을 사용할 수 있습니다.
